"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2809],{6846(e,t,a){a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"guides/writing-tests","title":"Writing Tests","description":"Learn best practices for writing effective analytics tests with DLest.","source":"@site/docs/guides/writing-tests.md","sourceDirName":"guides","slug":"/guides/writing-tests","permalink":"/dlest/pt-BR/guides/writing-tests","draft":false,"unlisted":false,"editUrl":"https://github.com/metricasboss/dlest/tree/main/website/docs/guides/writing-tests.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Your First Test","permalink":"/dlest/pt-BR/getting-started/first-test"},"next":{"title":"Puppeteer Replay (PT-BR)","permalink":"/dlest/pt-BR/guides/puppeteer-replay"}}');var s=a(4848),i=a(8453);const r={},c="Writing Tests",o={},l=[{value:"Test Structure",id:"test-structure",level:2},{value:"Test Suites",id:"test-suites",level:2},{value:"Test Context",id:"test-context",level:2},{value:"Page - Browser Control",id:"page---browser-control",level:3},{value:"DataLayer - Analytics Events",id:"datalayer---analytics-events",level:3},{value:"Network - HTTP Requests",id:"network---http-requests",level:3},{value:"Jest Matchers",id:"jest-matchers",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Testing Async Events",id:"testing-async-events",level:3},{value:"Testing SPAs (Single Page Apps)",id:"testing-spas-single-page-apps",level:3},{value:"Testing Forms",id:"testing-forms",level:3},{value:"Testing E-commerce Flows",id:"testing-e-commerce-flows",level:3},{value:"Testing Error Scenarios",id:"testing-error-scenarios",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Use Descriptive Test Names",id:"1-use-descriptive-test-names",level:3},{value:"2. Test One Thing at a Time",id:"2-test-one-thing-at-a-time",level:3},{value:"3. Keep Tests Independent",id:"3-keep-tests-independent",level:3},{value:"4. Use Setup Helpers",id:"4-use-setup-helpers",level:3},{value:"5. Handle Timing Issues",id:"5-handle-timing-issues",level:3},{value:"Debugging Tests",id:"debugging-tests",level:2},{value:"Verbose Output",id:"verbose-output",level:3},{value:"Visual Debugging",id:"visual-debugging",level:3},{value:"Screenshots",id:"screenshots",level:3},{value:"Console Logs",id:"console-logs",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"writing-tests",children:"Writing Tests"})}),"\n",(0,s.jsx)(t.p,{children:"Learn best practices for writing effective analytics tests with DLest."}),"\n",(0,s.jsx)(t.h2,{id:"test-structure",children:"Test Structure"}),"\n",(0,s.jsx)(t.p,{children:"DLest uses a Jest-like API that should feel familiar:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const { test, expect } = require('dlest');\n\ntest('descriptive test name', async ({ page, dataLayer }) => {\n  // Your test code here\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"test-suites",children:"Test Suites"}),"\n",(0,s.jsxs)(t.p,{children:["Group related tests with ",(0,s.jsx)(t.code,{children:"test.describe"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test.describe('E-commerce Flow', () => {\n  test('product view tracking', async ({ page, dataLayer }) => {\n    await page.goto('http://localhost:3000/product/123');\n    await expect(dataLayer).toHaveEvent('view_item');\n  });\n\n  test('add to cart tracking', async ({ page, dataLayer }) => {\n    await page.goto('http://localhost:3000/product/123');\n    await page.click('#add-to-cart');\n    await expect(dataLayer).toHaveEvent('add_to_cart');\n  });\n\n  test('purchase tracking', async ({ page, dataLayer }) => {\n    await page.goto('http://localhost:3000/product/123');\n    await page.click('#add-to-cart');\n    await page.click('#checkout');\n\n    await expect(dataLayer).toHaveEvent('purchase', {\n      transaction_id: expect.any(String),\n      value: expect.any(Number)\n    });\n  });\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"test-context",children:"Test Context"}),"\n",(0,s.jsx)(t.p,{children:"Every test receives a context object with fixtures:"}),"\n",(0,s.jsx)(t.h3,{id:"page---browser-control",children:"Page - Browser Control"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('example', async ({ page }) => {\n  // Navigate\n  await page.goto('https://example.com');\n\n  // Interact with elements\n  await page.click('#button');\n  await page.fill('#email', 'test@example.com');\n\n  // Wait for elements\n  await page.waitForSelector('.product');\n\n  // Type text\n  await page.type('#search', 'laptop');\n\n  // Press keys\n  await page.press('#input', 'Enter');\n\n  // Take screenshot\n  await page.screenshot({ path: 'screenshot.png' });\n});\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://playwright.dev/docs/api/class-page",children:"Full Playwright Page API \u2192"})}),"\n",(0,s.jsx)(t.h3,{id:"datalayer---analytics-events",children:"DataLayer - Analytics Events"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('example', async ({ page, dataLayer }) => {\n  await page.goto('http://localhost:3000');\n\n  // Check event exists\n  await expect(dataLayer).toHaveEvent('page_view');\n\n  // Check with specific data\n  await expect(dataLayer).toHaveEvent('purchase', {\n    value: 99.99,\n    currency: 'USD'\n  });\n\n  // Count events\n  await expect(dataLayer).toHaveEventCount('page_view', 1);\n\n  // Verify sequence\n  await expect(dataLayer).toHaveEventSequence([\n    'page_view',\n    'add_to_cart',\n    'purchase'\n  ]);\n});\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"/api/matchers",children:"All matchers \u2192"})}),"\n",(0,s.jsx)(t.h3,{id:"network---http-requests",children:"Network - HTTP Requests"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('example', async ({ page, network }) => {\n  await page.goto('http://localhost:3000');\n\n  // Validate GA4 request\n  await expect(network).toHaveGA4Event('purchase');\n\n  // Get all GA4 events\n  const events = network.getGA4Events();\n\n  // Get events by name\n  const purchases = network.getGA4EventsByName('purchase');\n});\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"/guides/network-validation",children:"Network validation guide \u2192"})}),"\n",(0,s.jsx)(t.h2,{id:"jest-matchers",children:"Jest Matchers"}),"\n",(0,s.jsx)(t.p,{children:"DLest supports Jest's powerful expect helpers:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('flexible matching', async ({ page, dataLayer }) => {\n  await page.goto('http://localhost:3000');\n\n  await expect(dataLayer).toHaveEvent('purchase', {\n    // Match any string\n    transaction_id: expect.any(String),\n\n    // Match any number\n    value: expect.any(Number),\n\n    // Exact value\n    currency: 'USD',\n\n    // String containing\n    description: expect.stringContaining('discount'),\n\n    // String matching regex\n    coupon_code: expect.stringMatching(/^SAVE[0-9]+$/),\n\n    // Array containing items\n    items: expect.arrayContaining([\n      expect.objectContaining({\n        item_id: 'prod-123',\n        quantity: 1\n      })\n    ]),\n\n    // Partial object match\n    user: expect.objectContaining({\n      id: '12345'\n    })\n  });\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,s.jsx)(t.h3,{id:"testing-async-events",children:"Testing Async Events"}),"\n",(0,s.jsx)(t.p,{children:"Some events fire after async operations:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('async purchase event', async ({ page, dataLayer }) => {\n  await page.click('#checkout');\n\n  // Option 1: Wait for specific time\n  await page.waitForTimeout(2000);\n\n  // Option 2: Wait for UI element\n  await page.waitForSelector('.success-message');\n\n  // Option 3: Wait for network idle\n  await page.waitForLoadState('networkidle');\n\n  await expect(dataLayer).toHaveEvent('purchase');\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"testing-spas-single-page-apps",children:"Testing SPAs (Single Page Apps)"}),"\n",(0,s.jsx)(t.p,{children:"For client-side routing:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('SPA navigation tracking', async ({ page, dataLayer }) => {\n  await page.goto('http://localhost:3000');\n\n  // First page view\n  await expect(dataLayer).toHaveEvent('page_view', {\n    page_path: '/'\n  });\n\n  // Navigate via client-side routing\n  await page.click('a[href=\"/products\"]');\n\n  // Wait for route change\n  await page.waitForURL('**/products');\n\n  // Second page view\n  await expect(dataLayer).toHaveEventCount('page_view', 2);\n  await expect(dataLayer).toHaveEvent('page_view', {\n    page_path: '/products'\n  });\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"testing-forms",children:"Testing Forms"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('form submission tracking', async ({ page, dataLayer }) => {\n  await page.goto('http://localhost:3000/contact');\n\n  // Fill form fields\n  await page.fill('#name', 'John Doe');\n  await page.fill('#email', 'john@example.com');\n  await page.selectOption('#category', 'sales');\n  await page.fill('#message', 'Hello world');\n\n  // Submit\n  await page.click('#submit');\n\n  // Validate tracking\n  await expect(dataLayer).toHaveEvent('form_submit', {\n    form_name: 'contact',\n    form_destination: 'sales'\n  });\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"testing-e-commerce-flows",children:"Testing E-commerce Flows"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('complete purchase journey', async ({ page, dataLayer }) => {\n  // 1. View product\n  await page.goto('http://localhost:3000/products.html');\n  await expect(dataLayer).toHaveEvent('view_item', {\n    value: 99.99,\n    currency: 'USD'\n  });\n\n  // 2. Add to cart\n  await page.click('#add-to-cart');\n  await expect(dataLayer).toHaveEvent('add_to_cart', {\n    value: 99.99,\n    items: expect.arrayContaining([\n      expect.objectContaining({\n        item_id: 'prod-123',\n        quantity: 1\n      })\n    ])\n  });\n\n  // 3. Complete purchase\n  await page.click('#checkout');\n  await page.waitForTimeout(1000);\n\n  await expect(dataLayer).toHaveEvent('purchase', {\n    transaction_id: expect.any(String),\n    value: 99.99,\n    currency: 'USD'\n  });\n\n  // 4. Verify complete sequence\n  await expect(dataLayer).toHaveEventSequence([\n    'view_item',\n    'add_to_cart',\n    'purchase'\n  ]);\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"testing-error-scenarios",children:"Testing Error Scenarios"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('track 404 page', async ({ page, dataLayer }) => {\n  await page.goto('http://localhost:3000/nonexistent-page');\n\n  await expect(dataLayer).toHaveEvent('page_view', {\n    page_path: '/nonexistent-page',\n    error_type: '404'\n  });\n});\n\ntest('track form validation error', async ({ page, dataLayer }) => {\n  await page.goto('http://localhost:3000/contact');\n  await page.click('#submit'); // Submit empty form\n\n  await expect(dataLayer).toHaveEvent('form_error', {\n    form_name: 'contact',\n    error_message: expect.stringContaining('required')\n  });\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(t.h3,{id:"1-use-descriptive-test-names",children:"1. Use Descriptive Test Names"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"// \u274c Bad\ntest('test 1', async ({ page, dataLayer }) => {});\n\n// \u2705 Good\ntest('purchase event fires with correct transaction_id and value', async ({ page, dataLayer }) => {});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"2-test-one-thing-at-a-time",children:"2. Test One Thing at a Time"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"// \u274c Bad - testing multiple things\ntest('all tracking works', async ({ page, dataLayer }) => {\n  // Tests 10 different events\n});\n\n// \u2705 Good - focused tests\ntest('page view event fires on homepage', async ({ page, dataLayer }) => {\n  // ...\n});\n\ntest('add to cart event fires with correct product data', async ({ page, dataLayer }) => {\n  // ...\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"3-keep-tests-independent",children:"3. Keep Tests Independent"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"// \u274c Bad - tests depend on each other\nlet productId;\n\ntest('create product', async () => {\n  productId = '123'; // Modifies shared state\n});\n\ntest('view product', async ({ page }) => {\n  await page.goto(`/product/${productId}`); // Depends on previous test\n});\n\n// \u2705 Good - tests are independent\ntest('view product tracking', async ({ page, dataLayer }) => {\n  const productId = '123'; // Defined locally\n  await page.goto(`/product/${productId}`);\n  await expect(dataLayer).toHaveEvent('view_item');\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"4-use-setup-helpers",children:"4. Use Setup Helpers"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"// Create helper functions for common setups\nasync function addProductToCart(page, productId) {\n  await page.goto(`http://localhost:3000/product/${productId}`);\n  await page.click('#add-to-cart');\n}\n\ntest('checkout from cart', async ({ page, dataLayer }) => {\n  await addProductToCart(page, '123');\n\n  await page.click('#checkout');\n  await expect(dataLayer).toHaveEvent('begin_checkout');\n});\n\ntest('purchase from cart', async ({ page, dataLayer }) => {\n  await addProductToCart(page, '123');\n\n  await page.click('#checkout');\n  await expect(dataLayer).toHaveEvent('purchase');\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"5-handle-timing-issues",children:"5. Handle Timing Issues"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('event fires after animation', async ({ page, dataLayer }) => {\n  await page.click('#animated-button');\n\n  // Wait for animation to complete\n  await page.waitForTimeout(500);\n\n  await expect(dataLayer).toHaveEvent('button_click');\n});\n\ntest('event fires after API call', async ({ page, dataLayer }) => {\n  await page.click('#submit');\n\n  // Wait for network to be idle\n  await page.waitForLoadState('networkidle');\n\n  await expect(dataLayer).toHaveEvent('form_submit');\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"debugging-tests",children:"Debugging Tests"}),"\n",(0,s.jsx)(t.h3,{id:"verbose-output",children:"Verbose Output"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"npx dlest --verbose\n"})}),"\n",(0,s.jsx)(t.p,{children:"Shows:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"All captured dataLayer events"}),"\n",(0,s.jsx)(t.li,{children:"Full event data"}),"\n",(0,s.jsx)(t.li,{children:"Expected vs actual comparison"}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"visual-debugging",children:"Visual Debugging"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"npx dlest --no-headless\n"})}),"\n",(0,s.jsx)(t.p,{children:"Opens a visible browser window so you can see what's happening."}),"\n",(0,s.jsx)(t.h3,{id:"screenshots",children:"Screenshots"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('debug with screenshot', async ({ page, dataLayer }) => {\n  await page.goto('http://localhost:3000');\n\n  // Take screenshot at specific point\n  await page.screenshot({ path: 'debug.png' });\n\n  await expect(dataLayer).toHaveEvent('page_view');\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"console-logs",children:"Console Logs"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"test('debug with console', async ({ page, dataLayer }) => {\n  // Listen to browser console\n  page.on('console', msg => console.log('Browser:', msg.text()));\n\n  await page.goto('http://localhost:3000');\n  await expect(dataLayer).toHaveEvent('page_view');\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Learn about ",(0,s.jsx)(t.a,{href:"/api/matchers",children:"available matchers"})]}),"\n",(0,s.jsxs)(t.li,{children:["See ",(0,s.jsx)(t.a,{href:"/examples/ecommerce",children:"real-world examples"})]}),"\n",(0,s.jsxs)(t.li,{children:["Set up ",(0,s.jsx)(t.a,{href:"/guides/remote-testing",children:"remote testing"})]}),"\n",(0,s.jsxs)(t.li,{children:["Configure ",(0,s.jsx)(t.a,{href:"/guides/network-validation",children:"network validation"})]}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,t,a){a.d(t,{R:()=>r,x:()=>c});var n=a(6540);const s={},i=n.createContext(s);function r(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);